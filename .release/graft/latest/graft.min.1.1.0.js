(()=>{"use strict";var e={237:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={name:"graft-js",version:"1.1.0",debug:!1}},344:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bridge=void 0;const n=r(593),s={map:new Map,tranId(e){const t="tx"+((new Date).getTime()+this.map.size);return this.map.set(t,e),t},trigger(e){const t=this.map.get(e);return this.map.delete(e),t||{}}},o={self:void 0,get isConnected(){return!!this.self},postNativeMessage(e){var t;const r=JSON.stringify(Object.assign({payload:{}},e));null===(t=this.self)||void 0===t||t.postMessage(r)}};t.bridge={set native(e){o.self=e},postMessage(e){const{command:t,payload:r={}}=e||{};return o.isConnected?t?new Promise(((e,n)=>{const i=s.tranId({command:t,resolve:e,reject:n});o.postNativeMessage(Object.assign({txid:i,command:t,payload:r}))})):Promise.reject(n.utils.error("invalidate command","bridge.postMessage")):Promise.reject(n.utils.error("native not connected","bridge.postMessage"))},receiveWebMessage(e){const{txid:t,receive:r={}}=e;if(!t)return console.error(n.utils.error("receive failed: 'txid' is not found","bridge.receiveWebMessage"),e);s.trigger(t).resolve(r)},onMessageEvent(e){console.warn(n.utils.error("'onMessageEvent' is override","bridge.onMessageEvent"))},postWebMessage(e){t.bridge.onMessageEvent(e)}}},101:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.html=void 0;const r={style:document.head.appendChild(document.createElement("style"))};t.html={page:document.firstElementChild,insert(e,t=document.body,r){const n="string"==typeof e?document.createTextNode(e):e;return r?t.insertBefore(n,r):t.appendChild(n)},query:(e,t=document.body)=>t.querySelector(e),queryAll:(e,t=document.body)=>[...t.querySelectorAll(e)],addStyleRule(...e){const{style:{sheet:t}}=r,n=(null==t?void 0:t.cssRules.length)||0;e.forEach((e=>null==t?void 0:t.insertRule(e,n)))}}},79:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.imports=t.template=void 0;const s=r(593);function o(e,{done:t,value:r}=e.next()){return t?Promise.resolve():r.then((t=>o(e)))}function*i(e,t){let r;for(;r=e.shift();)yield d(r,t)}function a(e,r){return Object.entries(e).map((([e,n])=>l(n,r).then((r=>{t.template[e]=r}))))}function c(e){return[...new Set(e)].map((e=>d(e)))}function l(e,t){return e?fetch(e+(t?`?${t}`:"")).then((e=>e.text())):Promise.resolve("")}function u(e,t){return new Promise((r=>{if(!e)return r(s.utils.error("'url' is required","inject.style"));const n=document.createElement("link");n.href=e+(t?`?${t}`:""),n.rel="stylesheet",n.onload=t=>r({url:e}),n.onerror=t=>r({url:e,error:t}),document.head.appendChild(n)}))}function d(e,t){return new Promise((r=>{if(!e)return r(s.utils.error("'url' is required","inject.script"));const n=document.createElement("script");n.src=e+(t?`?${t}`:""),n.onload=t=>r({url:e}),n.onerror=t=>r({url:e,error:t}),document.head.appendChild(n)}))}t.template={},t.imports={script:d,style:u,html:l,resource:function(e={},t=50){return n(this,void 0,void 0,(function*(){const r=(new Date).getTime(),{js:n=[],css:s=[],html:l={}}=e;var d;yield Promise.all([c(n),(d=s,[...new Set(d)].map((e=>u(e)))),a(l,r)]);const{script:g=[]}=e;yield new Promise((e=>setTimeout((t=>e(null)),t))),yield function(e,t){return o(i([...new Set(e)].flatMap((e=>e?[e]:[])),t))}(g,r)}))}}},97:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.log=void 0;const r={label:"",debug:"color:#6c757d;",info:"font-weight:bold;",storageKey:"Graft.log.brake",empty(){},getLogger(e,t,r,n){return t?e.bind(window,`%c${t}%o\n`,r,n):this.empty}};t.log={setting(e){Object.assign(r,e)},getLogger(...e){const{label:t,debug:n,info:s}=r;return{debug:r.getLogger(console.log,t,n,[...e]),info:r.getLogger(console.log,t,s,[...e,"info"]),warn:r.getLogger(console.warn,t,s,[...e,"info"]),error:r.getLogger(console.error,t,s,[...e,"info"])}},breake(e){this.getBreakes().indexOf(e)},addBreake(...e){e.forEach((e=>sessionStorage.setItem(`${r.storageKey}=${e}`,"")))},getBreakes(){const e=RegExp(`^${r.storageKey}=`);return Object.entries(sessionStorage).flatMap((([t])=>e.test(t)?[t.replace(e,"")]:[]))},removeBreake(...e){e.forEach((e=>sessionStorage.removeItem(`${r.storageKey}=${e}`)))},clearBreak(){const e=RegExp(`^${r.storageKey}=`);Object.entries(sessionStorage).forEach((([t])=>e.test(t)&&sessionStorage.removeItem(t)))}}},233:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resource=void 0;const r=(e=[])=>Object.assign(e,{add:t=>e.concat(t)}),n=(e={})=>Object.assign(Object.create({add:t=>Object.assign(e,t)}),e);t.resource={getResource(e){const{js:t=[],css:s=[],script:o=[],html:i={}}=e;return{html:n(i),js:r(t),css:r(s),script:r(o)}}}},430:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const n=r(97),s=new Map([["first",void 0]]);t.router={setFirst(e){s.set("first",e)},set(e,t){s.set(e,t)},get:e=>e?s.get(e):[...s.entries()],push(e,t={}){const r=s.get(e);history.pushState({key:e,param:t},"",""),this.onChange({key:e,target:r,param:t})},onChange(e){n.log.getLogger("router").error("onChange is override")}},window.addEventListener("popstate",(e=>{if(!s.get("first"))return;const{key:r="first",param:n}=e.state||{},o=s.get(r);t.router.onChange({key:r,param:n,target:o})}))},991:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tag=void 0;const n=r(101),s=r(593);t.tag=(e,...t)=>{const r=e instanceof HTMLElement?e:document.createElement(e);if(r.$)return r;const{onload:n,prop:s={},children:o=[]}=p(t);return g(r,s,o),r.$=a(r),n&&requestAnimationFrame((e=>n(r))),r};const o=new Map;t.tag.directive=(e,t)=>{o.set(e,t)};const i=[];t.tag.decorator=e=>{i.push(e)};const a=(e,t,r)=>{if(e.$)return e.$;const n=d(e),{insert:s,query:a,queryAll:g}=u(e),{event:m,removeEvent:p}=c(e),{voGetter:v,voSetter:f}=l(),h={cls:n,template:{},vo:{},directive:{},get owner(){return t},get parent(){return e.parentElement},get text(){return e.textContent||""},set text(t){e.textContent=t},get html(){return e.innerHTML||""},set html(t){e.innerHTML=t},get value(){return/^(?:checkbox|radio)$/.test(e.type)?e.checked?e.value:"":e.value||""},set value(t){/^(?:checkbox|radio)$/.test(e.type)?e.checked=!!t:e.value=t},insert:s,query:a,queryAll:g,event:m,removeEvent:p,getHtmls(){return v(this.vo,((e,t,r)=>Object.assign(e,{[t]:r.html})))},setHtmls(e={}){f(this.vo,e,((e,t)=>Object.assign(e,{html:t})))},getTexts(){return v(this.vo,((e,t,r)=>Object.assign(e,{[t]:r.text})))},setTexts(e={}){f(this.vo,e,((e,t)=>Object.assign(e,{text:t})))},getValues(){return v(this.vo,((e,t,r)=>Object.assign(e,{[t]:r.value})))},setValues(e={}){f(this.vo,e,((e,t)=>Object.assign(e,{value:t})))}};return r||(h.template=[...e.querySelectorAll("[data-template]")].reduce(((e,t)=>{const{innerHTML:r,dataset:{template:n}}=t;return n?Object.assign(e,{[n]:r}):e}),h.template),[...e.querySelectorAll("[data-template]")].forEach((e=>e.remove())),h.vo=[...e.querySelectorAll("[data-vo]")].reduce(((e,t)=>{const{dataset:{vo:r}}=t;return!r||e[r]?e:Object.assign(e,{[r]:t})}),h.vo),h.directive=[...e.querySelectorAll("[data-directive]")].reduce(((t,r)=>{const{dataset:{directive:n}}=r;if(!n)return t;const s=n&&o.get(n);return s&&s(r,e),t[n]?t[n].push(r):t[n]=[r],t}),h.directive)),requestAnimationFrame((t=>i.forEach((t=>t(e))))),Object.create(h)},c=e=>{const t=new Map;return{event:(r,n)=>{if(t.has(r))return console.warn(`duplicate event(${r}).`,new Error);const[s]=r.split(".");s&&(e.addEventListener(s,n),t.set(r,n))},removeEvent:r=>{if(!t.has(r))return;const[n]=r.split(".");n&&(e.removeEventListener(n,t.get(r)),t.delete(r))}}},l=()=>({voGetter:(e,t)=>Object.entries(e).reduce(((e,[r,{$:n}])=>t(e,r,n)),{}),voSetter:(e,t,r)=>{Object.entries(e).forEach((([e,{$:n}])=>t[e]&&r(n,t[e])))}}),u=e=>({insert:(t,r)=>n.html.insert(t,e,r),query:t=>n.html.query(t,e),queryAll:t=>n.html.queryAll(t,e)}),d=e=>{const{classList:t}=e;return{has:e=>t.contains(e),add(...e){return t.add(...e),this},remove(...e){return t.remove(...e),this}}},g=(e,t,r)=>{Object.entries(t).forEach((([t,r])=>{"html"==t?Object.assign(e,{innerHTML:r}):e.setAttribute(s.utils.kebabCase(t),r)})),r.forEach((t=>e.appendChild(t))),m(e)},m=e=>{const{firstElementChild:t}=e;if(!t)return;const r=[t];let n;for(;n=r.pop();){n.$=a(n,e,r);const{nextElementSibling:t,firstElementChild:s}=n;t&&r.push(t),s&&r.push(s)}},p=e=>e.reduce(((e,t)=>{switch(typeof t){case"function":return Object.assign(e,{onload:t});case"object":const r=Array.isArray(t)?"children":"prop";return Object.assign(e,{[r]:t});default:return e}}),{})},593:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.utils=void 0;const n=r(97),s={local:a(localStorage),session:a(sessionStorage)},o=function(){const e=(e,t,r,n)=>{document.cookie=`${e}=${t}; path=${r}; expries=${n}`};return{get(e){const t=document.cookie.split("; ").reduce(((e,t)=>{const[r,n]=t.split("=");return Object.assign(e,{[r]:n})}),{});return e?t[e]||"":t},set(t,r="",n="/",s=new Date){"string"==typeof t?e(t,r,n,s):Object.entries(t).forEach((([t,r])=>e(t,r,n,s)))},remove(t,r="/"){e(t,"",r,new Date)}}}(),i=function(){const e=new Map,t=(e,r,n)=>{if(!e||0==e.length)return Promise.reject(c("invalidate param","lazy:iterable"));if(r){const{value:s,done:o}=r.next(n);return o?Promise.resolve(n):s.then((n=>t(e,r,n)))}return t(e,function*(e){let t,r;for(;t=e.shift();)r=yield new Promise(((e,n)=>t&&t(r,e,n)))}(e.slice(0)))};return{on:t=>e.has(t)?Promise.reject(c(`'${t}' is duplicate key`,"lazy:on")):new Promise(((r,n)=>e.set(t,{resolve:r,reject:n}))),resolve:(t,r)=>{if(!e.has(t))return n.log.getLogger("lazy.resolve").error(c("invalidate key"));e.get(t).resolve(r),e.delete(t)},reject:(t,r)=>{if(!e.has(t))return n.log.getLogger("lazy.reject").warn(c("invalidate key","lazy:reject"));e.get(t).reject(r),e.delete(t)},contains:t=>e.has(t),all:(e=[])=>Promise.all(e),allSettled:(e=[])=>Promise.allSettled(e),any:(e=[])=>new Promise(((t,r)=>{let n=0;e.forEach((s=>{s.then((e=>t(e))).catch((t=>{n++,n==e.length&&r(t)}))}))})),race:(e=[])=>Promise.race(e),iterable:t}}();function a(e){const t="Graft.storage",r=RegExp(`^${t}=`);return{get:n=>n?e.getItem(`${t}=${n}`)||"":Object.entries(e).reduce(((e,[t,n])=>(r.test(t)&&Object.assign(e,{[t.replace(r,"")]:n}),e)),{}),set(r,n=""){"string"==typeof r?e.setItem(`${t}=${r}`,n):Object.entries(r).forEach((([r,n])=>e.setItem(`${t}=${r}`,n)))},remove(n){n?(Array.isArray(n)?n:[n]).forEach((r=>e.removeItem(`${t}=${r}`))):Object.entries(e).forEach((([t])=>r.test(t)&&e.removeItem(t)))}}}function c(e,t="Error"){return Object.assign(new Error(e),{name:t})}t.utils={storage:s,cookie:o,lazy:i,kebabCase:function(e){return e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()},camelCase:function(e){return e.toLowerCase().replace(/-([a-zA-Z])/g,((e,t)=>t.toUpperCase()))},snakeCase:function(e){return e.replace(/([a-z0-9])([A-Z])/g,"$1_$2").toLowerCase()},pascalCase:function(e){return e.toLowerCase().replace(/(^|-)([a-zA-Z])/g,((e,t,r)=>r.toUpperCase()))},clone:function(e){return Array.isArray(e)?[...e]:"object"==typeof e?Object.assign({},e):e},error:c}}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}(()=>{const e=r(237),t=r(593),n=r(233),s=r(97),o=r(101),i=r(991),a=r(344),c=r(430),l=r(79),u={config:e.config,template:l.template,log:s.log,utils:t.utils,bridge:a.bridge,router:c.router,imports:l.imports,resource:n.resource,html:o.html,tag:i.tag,view:{},get parent(){return u},init:e=>(e&&e(d),d),exec(e){e(d)}},d=window.Graft=Object.create(u);Graft.receiveWebMessage=a.bridge.receiveWebMessage,Graft.postWebMessage=a.bridge.postWebMessage})()})();
//# sourceMappingURL=graft.js.map